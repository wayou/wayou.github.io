---
layout: post
title: "é”å®šé¡¹ç›®çš„ node ç‰ˆæœ¬"
date: 2020-09-14 22:09:00 +0800
tags: 
---
    
# é”å®šé¡¹ç›®çš„ node ç‰ˆæœ¬

ä¸€äº›è€é¡¹ç›®å¯¹ node ç‰ˆæœ¬æ˜¯æœ‰è¦æ±‚çš„ï¼Œå¾€å¾€ä½¿ç”¨é»˜è®¤çš„æ–°ç‰ˆæœ¬åŒ…å®‰è£…ä¸ä¸Šï¼Œscripts ä¹Ÿè·‘ä¸èµ·æ¥ã€‚

ä¹‹å‰å°±é‡åˆ°è¿‡è¿è¡Œä¸€ä¸ªå°ç¨‹åºé¡¹ç›®æ—¶ï¼Œæ ¹æ®æ–‡æ¡£æ¥ï¼Œç¬¬ä¸€æ­¥å®‰è£…å°±å‡ºé”™ã€‚æœ¬ç€åŠæ³•æ€»æ¯”é—®é¢˜å¤šçš„ç†å¿µï¼Œæ¥ä¸€ä¸ªè§£å†³ä¸€ä¸ªã€‚é—®é¢˜è¿˜çœŸæ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‡ºç°ã€‚æŠ˜è…¾å¤´å¤©ï¼Œåœ¨è§£å†³ä¸€ä¸ªåŒ…çš„è¿è¡Œé—®é¢˜æ—¶ï¼Œå‘ç°åˆ‡æ¢åˆ°è¾ƒä½ç‰ˆæœ¬çš„ node åä¸€åˆ‡å®‰å¥½ã€‚

æ‰€ä»¥ï¼Œå¯¹äºè€é¡¹ç›®ï¼Œæœ€å¥½ä½¿ç”¨å…¼å®¹æ€§å¼ºçš„ç‰ˆæœ¬ 8 æˆ– 10 çš„ LTSã€‚

è§£å†³é—®é¢˜çš„æ ¹æœ¬æ–¹æ³•æ˜¯é¡¹ç›®ä¸­è¦å¯¹ node ç‰ˆæœ¬è¿›è¡Œæç¤ºæˆ–é”æ­»ï¼Œå¦åˆ™æ–°äººä»ä¼šè¸©å‘ã€‚

## .nvmrc

åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  .nvmrc æ–‡ä»¶å¯æŒ‡å®š nvm é»˜è®¤çš„ node ç‰ˆæœ¬ã€‚

```sh
$ node -v > .nvmrc
```

åœ¨æ‰§è¡Œ `nvm use`, `nvm install`, `nvm exec`, `nvm run` æˆ– `nvm which` è¿™äº›å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šä»è¯¥æ–‡ä»¶è¯»å–ç‰ˆæœ¬ä¿¡æ¯ã€‚

åœ¨æ–°çš„ç¯å¢ƒä¸‹ï¼Œclone é¡¹ç›®åé€šè¿‡ `nvm install && nvm use` å°±å¯ä½¿ç”¨ä¸Šä¸é¡¹ç›®ç›¸åŒ¹é…çš„ node ç‰ˆæœ¬ã€‚


## `engines`

é€šè¿‡åœ¨ package.json ä¸­æŒ‡å®š `engines` å­—æ®µï¼Œå¯é™å®šé¡¹ç›®ä½¿ç”¨çš„ node ç‰ˆæœ¬ï¼Œç”šè‡³ npm ç‰ˆæœ¬ã€‚

ä¸è¿‡ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œé…ç½®ä¹‹åä½ ä¼šå‘ç°ï¼Œè¯¥å­—æ®µåªå¯¹ yarn ç”Ÿæ•ˆï¼š

```
$ yarn
yarn install v1.22.5
info No lockfile found.
[1/5] ğŸ”  Validating package.json...
error test-node@1.0.0: The engine "node" is incompatible with this module. Expected version ">=14". Got "10.22.0"
error Found incompatible module.
info Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.
```

è€Œä½¿ç”¨ npm è¿›è¡Œå®‰è£…æ—¶ï¼Œç›´æ¥æˆåŠŸæ²¡æœ‰æç¤ºï¼Œè¿ warnning éƒ½æ²¡æœ‰ï¼š

```sh
$ npm i
npm WARN test-node@1.0.0 No description
npm WARN test-node@1.0.0 No repository field.

up to date in 0.48s
found 0 vulnerabilities
```

æ ¹æ® npm æ–‡æ¡£ä¸­å…³äº [`engines`](https://docs.npmjs.com/files/package.json#engines) çš„éƒ¨åˆ†ï¼Œå‘ç°è¦è®© npm è¯†åˆ« `engines` å­—æ®µï¼Œè¿˜éœ€è¦é…ç½® `engine-strict: true`ï¼Œä½†æ˜¯è¿›ä¸€æ­¥çœ‹ï¼Œ

> This feature was removed in npm 3.0.0

ç‹å¾·å‘ï¼Ÿ

å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿›ä¸€æ­¥ç ”ç©¶å‘ç°ï¼Œåˆ›å»º `.npmrc` æ–‡ä»¶é…ç½®å¦‚ä¸‹å†…å®¹ï¼š

```
engine-strict = true
```

å°±å¯ä»¥ä½¿å¾— `engines` å­—æ®µå¯¹ npm ç”Ÿæ•ˆäº†ã€‚

```sh
$ npm i
npm ERR! code ENOTSUP
npm ERR! notsup Unsupported engine for test-node@1.0.0: wanted: {"node":">=14"} (current: {"node":"10.22.0","npm":"6.14.6"})
npm ERR! notsup Not compatible with your version of node/npm: test-node@1.0.0
npm ERR! notsup Not compatible with your version of node/npm: test-node@1.0.0
npm ERR! notsup Required: {"node":">=14"}
npm ERR! notsup Actual:   {"npm":"6.14.6","node":"10.22.0"}

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/wayongliu/.npm/_logs/2020-09-14T13_43_33_020Z-debug.log
```

ç»“åˆä¹‹å‰å…³äº[é¡¹ç›®ä¸­ç§æœ‰ npm æºçš„è®¾ç½®](https://github.com/wayou/wayou.github.io/issues/229)ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä¸­æ·»åŠ  `.npmrc` çœŸçš„æ˜¯æœ€ä½³å®è·µäº†ã€‚


## ç›¸å…³èµ„æº

- [.nvmrc](https://github.com/nvm-sh/nvm#nvmrc)
- [npm package.json engines](https://docs.npmjs.com/files/package.json#engines)
- [TIP: Ensuring your team uses YARN/NPM](https://wawand.co/blog/posts/tip-ensuring-yarn/)

    