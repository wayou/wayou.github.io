---
layout: post
title: fish è‡ªåŠ¨è¡¥å…¨å­å‘½ä»¤
date: 2020-11-15T12:18:42Z
---
# fish è‡ªåŠ¨è¡¥å…¨å­å‘½ä»¤

ä¹‹å‰åœ¨ ã€Œ[åˆ›å»º fish shell è‡ªåŠ¨è¡¥å…¨æ–‡ä»¶](https://github.com/wayou/wayou.github.io/issues/190)ã€ ä¸­ä»‹ç»äº†å¦‚ä½•åˆ›å»º fish çš„è¡¥å…¨æ–‡ä»¶ï¼Œå®ç°å¯¹å‘½ä»¤çš„å‹å¥½è¡¥å…¨æç¤ºã€‚é€šè¿‡å½¢å¦‚ `complete -c <command> -a ["å‚æ•°åˆ—è¡¨"]` çš„è„šæœ¬æ¥å®ç°çš„ã€‚

æ¯”å¦‚ `complete -c myprog -a "yes no"` å¯åœ¨è¾“å…¥ `myprog` åé€šè¿‡ <kbd>TAB</kbd> å”¤èµ·æç¤ºï¼š

```sh
$ myprog<tab>
no yes
```

ä½†å¦‚æœ `<comamnd>` åŒ…å«å­å‘½ä»¤æ—¶ï¼Œåˆ™éœ€è¦éº»çƒ¦äº›ã€‚æ¯”å¦‚æ‹¿ `git commit` æ¥è¯´ï¼Œä¸ºäº†å®ç°åœ¨è¾“å…¥è¯¥å‘½ä»¤æ—¶æç¤ºä¸€äº›ä¿¡æ¯ï¼Œå®æµ‹å¦‚ä¸‹å½¢å¼æ˜¯ä¸è¡Œçš„ï¼š

```sh
complete -c git-commit -a "yes no"
complete -c "git commit" -a "yes no"
```

åŒæ—¶ï¼Œæƒ³è¦å®ç° `git commit -m<TAB>` åœ¨è¿›è¡Œ git æäº¤æ—¶ï¼Œè¿›è¡Œä¸€äº›æç¤ºï¼Œé™¤äº†éœ€è¦è§£å†³ä¸Šé¢å­å‘½ä»¤åˆ¤å®šçš„é—®é¢˜ï¼Œè¿˜éœ€è¦åˆ¤å®šè¿™é‡Œçš„ `-m` å‚æ•°ã€‚

## åˆ¤æ–­å­å‘½ä»¤

æŸ¥çœ‹ fish åœ¨ GitHub çš„ä»“åº“å¯å‘ç°ï¼Œåœ¨ [`fish-shell/share/functions/`](https://github.com/fish-shell/fish-shell/tree/master/share/functions) ç›®å½•ä¸‹æä¾›äº†å¾ˆå¤šå·¥å…·æ–¹æ³•ï¼Œ é€šè¿‡ `__fish_seen_subcommand_from` é…åˆ `complete` çš„ `-n` å‚æ•°å¯å®ç°å­å‘½ä»¤çš„åˆ¤å®šã€‚

è¯¥å·¥å…·æ–¹æ³•éœ€è¦ç»“åˆ `-n`ï¼ˆconditionï¼‰å‚æ•°ï¼ŒæŒ‡å®šä¸€æ®µ shell è„šæœ¬ï¼Œå½“è„šæœ¬è¿”å› 0 æ—¶æ‰€æŒ‡å®šçš„è‡ªåŠ¨è¡¥å…¨æ‰ç”Ÿæ•ˆã€‚

```sh
complete -f -c git -n '__fish_seen_subcommand_from commit' -a 'test' -d "the test command will appear after commit"
```

ä¸Šè¿°è„šæœ¬å®ç°çš„æ•ˆæœï¼Œæ˜¯åœ¨è¾“å…¥ `git commit` ä¹‹åï¼Œ<kbd>TAB</kbd> ä¼šè§¦å‘ `test` å‘½ä»¤çš„è‡ªåŠ¨è¡¥å…¨ï¼Œå½“ä¸”ä»…å½“ `git` åè·Ÿçš„æ˜¯ `commit` è¿™ä¸ªå­å‘½ä»¤ã€‚

## `-s` `-l` çš„ç”¨æ³•

ä¸€èˆ¬å‘½ä»¤ä¼šéœ€è¦å¸¦å‚æ•°ï¼Œè¿™äº›å‚æ•°æˆ–æ˜¯é€šè¿‡ `-` åŠ ç¼©å†™æˆ– `--` åŠ å®Œæ•´çš„å‚æ•°åç§°æä¾›ã€‚é€šè¿‡ `-s`ï¼ˆshortï¼‰ã€ `-l`ï¼ˆlongï¼‰ ä¾¿å¯æŒ‡å®šå‘½ä»¤éœ€è¦è¡¥å…¨çš„å‚æ•°åç§°ã€‚

```sh
complete -f -c git -n '__fish_seen_subcommand_from commit' -s m --l message -d "specify the commit message"
complete -f -c git -n '__fish_seen_subcommand_from commit' -s f --l foo -d "argument foo"
complete -f -c git -n '__fish_seen_subcommand_from commit' -s b --l bar -d "argument bar"
complete -f -c git -n '__fish_seen_subcommand_from commit' -s b --l baz -d "argument baz"
complete -f -c git -n '__fish_seen_subcommand_from commit' -s b --l quz -d "argument quz"
```

ä¸Šè¿°è„šæœ¬å®ç°çš„æ•ˆæœæ˜¯ï¼Œåœ¨è¾“å…¥ `git commit -<TAB>` åï¼Œå‚æ•°åˆ—è¡¨ä¼šä½œä¸ºå€™é€‰è¡¥å…¨åˆ—å‡ºæ¥ï¼š

```sh
$ git commit -
-b  --quz  (argument quz)  -m  --message  (specify the commit message)  --baz  (argument baz)
-f  --foo  (argument foo)  --bar                        (argument bar)
```

å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å‚æ•°æŒ‰å­—æ¯é¡ºåºè¿›è¡Œäº†é‡æ’ï¼Œå¯é€šè¿‡ `-k` ï¼ˆkeep orderï¼‰ æ¥ä¿æŒä¹¦å†™æ—¶æŒ‡å®šçš„é¡ºåºã€‚`-k` å‚æ•°å¯¹äº `-a` æŒ‡å®šçš„å‘½ä»¤ä¹Ÿé€‚ç”¨ã€‚

## åˆ¤å®šå‚æ•°

é€šè¿‡ `__fish_seen_argument` å·¥å…·æ–¹æ³•ï¼Œå¯åˆ¤å®šè¾“å…¥çš„å‘½ä»¤åæœ‰æ²¡æœ‰è·ŸæŒ‡å®šå‚æ•°ã€‚

```sh
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'build' -d "Changes that affect the build system or \r\ntexternal dependencies (example scopes: gulp, broccoli, npm)"
```

è¿™é‡Œåˆ¤å®šå‚æ•°çš„å†™æ³•ï¼Œå’Œå‰é¢ `-s` `-l` ä¸­ä»‹ç»çš„ä¸€è‡´ã€‚

ä¸Šè¿°è„šæœ¬å®ç°çš„æ•ˆæœæ˜¯ï¼Œå½“è¾“å…¥ `git commit -m<TAB>` æ—¶ä¼šè‡ªåŠ¨è¡¥ä¸Š `build` å‘½ä»¤ã€‚

åˆ°è¿™é‡Œå°±å®Œæˆäº†å­å‘½ä»¤å’Œå‚æ•°çš„åˆ¤å®šã€‚æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç”¨äºä¸€äº›å®ç”¨çš„åœºæ™¯ï¼Œæ¯”å¦‚ Angular çš„æäº¤æ¶ˆæ¯è§„å®šäº†å¦‚ä¸‹çš„å½¢å¼ï¼š

```
<type>(<scope>): <short summary>
```

å…¶ä¸­ `<type>` åŒ…å«å¦‚ä¸‹å¯é€‰å€¼ï¼š

- build: Changes that affect the build system or external dependencies (example scopes: gulp, broccoli, npm)
- ci: Changes to our CI configuration files and scripts (example scopes: Circle, BrowserStack, SauceLabs)
- docs: Documentation only changes
- feat: A new feature
- fix: A bug fix
- perf: A code change that improves performance
- refactor: A code change that neither fixes a bug nor adds a feature
- test: Adding missing tests or correcting existing tests

å¯é€šè¿‡å‰é¢ä»‹ç»çš„æ–¹æ³•ï¼Œå°†è¿™é‡Œçš„ type åœ¨è¿›è¡Œ git commit æ—¶ç»™æç¤ºå‡ºæ¥ã€‚

## å®ç° Angular commit type çš„è‡ªåŠ¨æç¤º

æœ€åï¼Œå®ç°è¿™ä¸€æ•ˆæœçš„è„šæœ¬å¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š

```sh
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'build' -d "Changes that affect the build system or \r\ntexternal dependencies (example scopes: gulp, broccoli, npm)"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'ci' -d "Changes to our CI configuration files and scripts (example scopes: Circle, BrowserStack, SauceLabs)"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'docs' -d "Documentation only changes"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'feat' -d "A new feature"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'fix' -d "A bug fix"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'perf' -d "A code change that improves performance"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'refactor' -d "A code change that neither fixes a bug nor adds a feature"
complete -k -f -c git -n '__fish_seen_subcommand_from commit; and __fish_seen_argument -s m -l message' -a 'test' -d "Adding missing tests or correcting existing tests"
```

ç›¸å…³ä»“åº“ ğŸ‘‰ [wayou/angular-commit-complete](https://github.com/wayou/angular-commit-complete)ã€‚

## ç›¸å…³èµ„æº

- [complete - edit command specific tab-completionsÂ¶](https://fishshell.com/docs/current/cmds/complete.html)
- [weavejester/fish-git/completions/git.fish](https://github.com/weavejester/fish-git/blob/master/completions/git.fish)
- [Creating autocomplete script with sub commands](https://stackoverflow.com/a/16673041/1553656)
- [Git commit messages for the bold and the daring](https://backlog.com/blog/git-commit-messages-bold-daring/)
- [wayou/angular-commit-complete](https://github.com/wayou/angular-commit-complete)
- [angular - angular/CONTRIBUTING.md](https://github.com/angular/angular/blob/master/CONTRIBUTING.md#type)

