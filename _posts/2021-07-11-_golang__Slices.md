---
layout: post
title: "[golang] Slices"
date: 2021-07-11T00:27:00Z
---
# [golang] Slices

## Slice çš„å£°æ˜

è¯­æ³•åŒæ•°ç»„ï¼Œåªæ˜¯ä¸éœ€è¦æŒ‡å®šå¤§å°äº†ã€‚

```go
// æ³¨æ„ä¸æ•°ç»„è¿›è¡ŒåŒºåˆ†ï¼Œæ•°ç»„çš„å¤§å°ä¸èƒ½çœç•¥ï¼Œéœ€è¦ä½¿ç”¨ `...`
var slices = []int{
	1, 2, 3,
}

// ä½¿ç”¨ç´¢å¼•åˆå§‹åŒ–éƒ¨åˆ†å…ƒç´ ï¼Œè¯¥è¯­å¥åˆ›å§‹äº†ä¸€ä¸ªé•¿åº¦ä¸º 5 çš„ slice ä¸”è®¾ç½®æœ€åä¸€ä¸ªå…ƒç´ ä¸º 99
var slices2 = []int{
	4: 99,
}

fmt.Println(slices, slices2)
// [1 2 3] [0 0 0 0 99]
```

è®¿é—®ä¹ŸåŒæ•°ç»„ä¸€æ ·ï¼Œé€šè¿‡ä¸‹æ ‡å®Œæˆã€‚

```go
fmt.Println(slices[1])  // 2
fmt.Println(slices2[6]) // ğŸš¨ panic: runtime error: index out of range [6] with length 5
```

## Slice çš„åˆå§‹å€¼

å½“å£°æ˜ slice æœªåˆå§‹åŒ–æ—¶ï¼Œå…¶åˆå§‹å€¼ä¸º `nil`

```go
var mySlice []int
fmt.Println(mySlice == nil) // true
```

ä¸åŒäºå…¶ä»–è¯­è¨€ä¸­çš„ `null`ï¼Œ`nil` è¡¨ç¤ºæ²¡æœ‰å€¼ï¼Œ`nil` æ˜¯æ— ç±»å‹çš„ï¼Œæ‰€ä»¥å¯èµ‹å€¼ç»™ä»»æ„ç±»å‹ï¼Œæ­¤å¤„å€¼ä¸º `nil` çš„ slice æ˜¯ç©ºçš„ï¼Œå¦‚æœæ‰“å°å‡ºæ¥å¯çœ‹åˆ°ä¸€ä¸ªç©ºæ•°ç»„ `[]`ã€‚

## Slice çš„å¸¸ç”¨æ–¹æ³•

### len

åŒæ•°ç»„ï¼Œè·å– slice çš„é•¿åº¦

### append

å‘ slice è¿½åŠ å…ƒç´ 

```go
var mySlice []int
// è¿½åŠ ä¸€ä¸ªå…ƒç´ 
mySlice = append(mySlice, 1)
// å¯ä¸€æ¬¡æ€§è¿½åŠ å¤šä¸ªå…ƒç´ 
mySlice = append(mySlice, 2, 3, 4)
// å¯é€šè¿‡ `...` æ“ä½œç¬¦å°†å¦ä¸€ä¸ª slice å±•å¼€åè¿›è¡Œè¿½åŠ 
var x = []int{5, 6}
mySlice = append(mySlice, x...)
fmt.Println(mySlice)
```

æ³¨æ„ï¼šéœ€è¦å°† `append` çš„è¿”å›å†èµ‹å€¼åˆ°åŸæ¥çš„å˜é‡ï¼Œå› ä¸º Go ä¸­å‡½æ•°è°ƒç”¨æ—¶å‚æ•°æ˜¯å€¼ä¼ é€’ï¼Œå¹¶ä¸ä¼šä¿®æ”¹åŸæ¥çš„æ•°æ®ã€‚

### Capacity

Slice çš„å€¼æ˜¯å­˜å‚¨åœ¨ä¸€å—è¿ç»­å†…å­˜ä¸­ï¼Œslice çš„ capacity ä¸€èˆ¬ä¼šæ¯” slice å®é™…é•¿åº¦å¤§ä¸€äº›ï¼Œç”¨äºåœ¨å‘ slice æ·»åŠ å…ƒç´ æ—¶é¢„ç•™çš„ç©ºé—´ã€‚å½“å‘ slice æ·»åŠ çš„å…ƒç´ è¶…è¿‡ capacity æ—¶ï¼Œå®ç°ä¸Šï¼ŒGo ä¼šåˆ›å§‹ä¸€ä¸ªæ–°çš„ sliceï¼Œå…¶ capacity æ¯”æ·»åŠ å…ƒç´ åçš„æ€»é•¿åº¦è¦å¤§ï¼Œå°†åŸæ¥ slice çš„å…ƒç´ å¤åˆ¶åˆ°è¿™ä¸ªæ–° slice å¹¶ä¸”è¿”å›ã€‚

é€šè¿‡å¦‚ä¸‹çš„ä»£ç å¯çœ‹åˆ° capacity çš„å¢é•¿è¿‡ç¨‹ï¼š

```go
func main() {
	var x []int
	x = append(x, 1)
	fmt.Println(x, len(x), cap(x))
	x = append(x, 2)
	fmt.Println(x, len(x), cap(x))
	x = append(x, 3)
	fmt.Println(x, len(x), cap(x))
	x = append(x, 4)
	fmt.Println(x, len(x), cap(x))
	x = append(x, 5)
	fmt.Println(x, len(x), cap(x))
}

// è¾“å‡ºï¼š
// [1] 1 1
// [1 2] 2 2
// [1 2 3] 3 4
// [1 2 3 4] 4 4
// [1 2 3 4 5] 5 8
```

å¯ä»¥çœ‹åˆ°éšç€å…ƒç´ çš„å¢åŠ  capacity åœ¨é€‚æ—¶å¢å¤§ã€‚ä½†å¦‚æœæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å°±æŒ‡å®šå¥½ slice çš„å¤§å°ï¼ŒåŠ¿å¿…ä¼šèŠ‚çœäº›å¼€é”€ã€‚é€šè¿‡ `make` æ¥åˆ›å§‹ä¸€ä¸ªåŒ…å«åˆå§‹ capacity çš„ sliceã€‚

### make

é€šè¿‡ `make` å¯æŒ‡å®š slice ç±»å‹ï¼Œé•¿åº¦å’Œ capacityã€‚

```go
func main() {
	x := make([]int, 5, 10)
	fmt.Println(x, len(x), cap(x))
	// [0 0 0 0 0] 5 10
}
```

ä¸Šé¢ç¤ºä¾‹åˆ›å§‹äº†ä¸€ä¸ªé•¿åº¦ä¸º 5ï¼Œå¹¶ä¸”å¡«å……äº†é›¶å€¼çš„ sliceï¼Œå…¶å®¹é‡ capacity ä¸º 10ã€‚

ä½†è¿™æ ·åˆ›å§‹å slice ä¸­çš„å€¼æ˜¯æœªåˆå§‹åŒ–çš„é›¶å€¼ï¼Œå®¹æ˜“é€šè¿‡ç´¢å¼•è¿›è¡Œè®¿é—®å’Œæ“ä½œï¼ŒåŸ‹ä¸‹éšæ‚£ï¼Œå¯ä»¥å£°æ˜é•¿åº¦ 0ï¼ŒåªæŒ‡å®šæƒ³è¦çš„ capacityã€‚è¿™æ ·é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ æ—¶å°±ä¼šæœ‰æŠ¥é”™äº†ã€‚

```go
func main() {
	x := make([]int, 0, 10)
	fmt.Println(x, len(x), cap(x), x[2]) //ğŸš¨ panic: runtime error: index out of range [2] with length 0
	x = append(x, 1, 2, 3)
	fmt.Println(x, len(x), cap(x), x[2]) // [1 2 3] 3 10 3
}
```

ä½¿ç”¨ slice çš„ä¸€ä¸ªåŸåˆ™æ˜¯å°½é‡é¿å… capacity çš„å¢é•¿ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„å¼€é”€ã€‚

### ä»ç°æœ‰ slice æˆªå–

ç°æœ‰ slice å˜é‡åè·Ÿçš„ä¸­æ‹¬å·é‡ŒæŒ‡å®šéœ€è¦æˆªå–çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ï¼Œ`[start,end)`ï¼Œå¯å¾—åˆ°æ–°çš„ sliceã€‚

```go
x := []int{1, 2, 3, 4, 5}
a := x[1:3]
b := x[:3]
c := x[1:]
fmt.Println(a, b, c)
// [2 3] [1 2 3] [2 3 4 5]
```

ä½†ä¸Šè¿°æˆªå–æ“ä½œï¼Œå¹¶æ²¡æœ‰åˆ›å§‹æ–°çš„å†…å­˜ç©ºé—´ï¼Œæ–°å½¢æˆçš„ slice ä¸åŸæ¥çš„ slice æ˜¯å…±ç”¨ç›¸åŒçš„å­˜å‚¨ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå¯¹å…¶ä¸­ä»»æ„ slice æœ‰ä¿®æ”¹ï¼Œä¼šå½±å“æ‰€æœ‰å˜é‡ã€‚è¯·çœ‹å¦ä¸€ä¸ªç¤ºä¾‹ï¼š

```go
func main() {
	x := []int{1, 2, 3, 4}
	y := x[:2]
	z := x[1:]
	x[1] = 20
	y[0] = 10
	z[1] = 30
	fmt.Println(x, y, z) // [10 20 30 4] [10 20] [20 30 4]
}
```

æˆªå–æ“ä½œå’Œ `append` ç»“åˆæ—¶ä¼šæœ‰äº›è¿·æƒ‘æ€§ï¼Œè¯·çœ‹å¦‚ä¸‹ç¤ºä¾‹ï¼š

```go
func main() {
	x := []int{1, 2, 3, 4}
	y := x[:2]
	y = append(y, 30)
	fmt.Println(x, y) // [1 2 30 4] [1 2 30]
}
```

å¯ä»¥çœ‹åˆ°ï¼Œä»åŸ slice æˆªå–å‡ºæ¥çš„å­é›† `y` æ·»åŠ æ–°å…ƒç´ åç›´æ¥æ›¿æ¢äº†è¯¥å†…å­˜ç©ºé—´çš„å€¼ï¼Œè€Œå¹¶ä¸æ˜¯å°†åŸæ¥çš„ slice é•¿åº¦å¢åŠ äº†ä¸€ä¸ªã€‚

å½“ä»ä¸€ä¸ª slice æˆªå–æ–°çš„ slice æ—¶ï¼Œæ–°çš„ capacity å’ŒåŸ slice ä¸€æ ·ï¼Œå†å‡å» offsetã€‚æ¯”å¦‚ä¸Šé¢ `y` æ˜¯ä»å¼€å¤´æˆªå–çš„ï¼Œæ‰€ä»¥ offset ä¸º 0ï¼Œå…¶ capacity å°±ä¹Ÿå’ŒåŸ slice æ˜¯ä¸€æ ·çš„ã€‚

ä½†å…¶é•¿åº¦å´æ˜¯ 2ï¼Œå½“ append æ—¶ï¼Œå°†å…ƒç´ è®¾ç½®åˆ°ç´¢å¼•ä¸º 2 çš„ä½ç½®ï¼Œæ•ˆæœå°±æ˜¯ä¿®æ”¹äº†åŸæ¥çš„å†…å®¹ï¼Œè€Œä¸æ˜¯æ‰©å±•ç©ºé—´ã€‚

æˆªå–å‡ºæ¥çš„å­ sliceï¼Œåœ¨å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå¦‚æœåŸæ¥æœ‰å€¼ï¼Œåˆ™ä¼šäº’ç›¸å½±å“ï¼Œå¦‚æœåŸæ¥æ²¡æœ‰å€¼ï¼Œåˆ™ä¸ä¼šå½±å“ã€‚å…·ä½“æ¥è¯´ï¼š

```go
func main() {
	x := make([]int, 0, 5)
	x = append(x, 1, 2, 3, 4)
	y := x[:2]
	z := x[2:]
	fmt.Println(cap(x), cap(y), cap(z))
	y = append(y, 30, 40, 50)
	fmt.Println(x, y, z) // 1. [1 2 30 40] [1 2 30 40 50] [30 40]
	x = append(x, 60)
	fmt.Println(x, y, z) // 2. [1 2 30 40 60] [1 2 30 40 60] [30 40]
	z = append(z, 70)
	fmt.Println(x, y, z) // 3. [1 2 30 40 70] [1 2 30 40 70] [30 40 70]
}
```

ä¸Šé¢ç¤ºä¾‹ä»£ç ä¸­ï¼Œ

1. å¤„è®¾ç½®äº† y çš„ 2ï¼Œ3ï¼Œ4 ç´¢å¼•ä½ç½®çš„å€¼ï¼Œä½†å› ä¸º y å’Œ x, z å…±äº«çš„ä½ç½®ä¸­ï¼Œåªæœ‰ 2,3 åŸæ¥æ˜¯æœ‰å€¼çš„ï¼Œæ‰€ä»¥è¿™ä¸¤å¤„çš„å˜åŠ¨åŒæ­¥åˆ°äº† x, z ä¸­
2. å¤„ä¿®æ”¹äº† x ç´¢å¼•ä¸º 4 å¤„çš„å€¼ï¼Œæ­¤æ—¶ y ç´¢å¼•ä¸º 4 å¤„ä¹Ÿæœ‰å€¼ï¼Œæ‰€ä»¥ä¹ŸåŒæ­¥è¢«ä¿®æ”¹äº†ï¼Œå› ä¸º z å¯¹åº”åŸæ¥ x ç´¢å¼• 4 å¤„æ²¡æœ‰å€¼ï¼Œæ‰€ä»¥ä¸å—å½±å“
3. æœ€åè®¾ç½® z æ—¶ï¼Œæ‰€æœ‰éƒ½å—å½±å“äº†

åº”è¯¥å°½é‡é¿å…åƒä¸Šé¢è¿™æ ·å¯¹å­ slice è¿›è¡Œ append æ“ä½œï¼Œå½¢æˆäº’ç›¸å½±å“ã€‚å¯¹åº”åœ°ï¼Œå¯ä½¿ç”¨ full slice expression æ¥åˆ›å»ºå­ sliceï¼Œå…¶å®å°±æ˜¯é™åˆ¶å­ slice é•¿åº¦ä¸ capacity ä¸€è‡´ï¼Œè¿™æ ·åœ¨å¯¹å­ slice è¿›è¡Œ append æ“ä½œæ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ sliceï¼Œå½“ç„¶å°±ä¸ä¼šå½±å“åŸæœ‰çš„æ•°æ®ã€‚

```go
y := x[:2:2]
z := x[2:4:4] 
```

### copy

æˆªå–çš„æ–¹å¼ä¼šæœ‰å†…å­˜å…±äº«çš„é—®é¢˜ï¼Œé€šè¿‡ `copy` å¤åˆ¶çš„è¯•è¯•åˆ™æ˜¯ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ sliceï¼Œ

```go
func main() {
	x := []int{1, 2, 3, 4}
	y := make([]int, 2)
	num := copy(y, x)
	fmt.Println(num, y) // 2 [1 2]
}
```

copy ä¼šå°½å¯èƒ½å¤šåœ°ä»æº slice å¤åˆ¶å…ƒç´ åˆ°ç›®æ ‡ sliceï¼Œå…·ä½“ä¸ªæ•°å–å†³äºè°çš„ length æ›´å°ã€‚

ä¹Ÿå¯ä»¥æŒ‡å®šä»å“ªé‡Œå¼€å§‹å¤åˆ¶ï¼š

```go
func main() {
	x := []int{1, 2, 3, 4}
	y := make([]int, 2)
	num := copy(y, x[2:])
	fmt.Println(num, y) // 2 [3 4]
}
```

ç”šè‡³æŒ‡å®šç›®æ ‡ slice ä»å“ªé‡Œå¼€å§‹å­˜æ”¾ï¼Œä»¥åŠæºå’Œç›®æ ‡å¯æŒ‡å®šä¸ºåŒä¸€ slice ï¼š

```go
func main() {
	x := []int{1, 2, 3, 4}
	num := copy(x[:3], x[1:])
	fmt.Println(num, x) // 3 [2 3 4 4]
}
```

ä»¥ä¸Šã€‚

