I"õ/<h1 id="typescript-ä¸­éä»£ç æ¨¡å—çš„å¯¼å…¥">TypeScript ä¸­éä»£ç æ¨¡å—çš„å¯¼å…¥</h1>

<p>éœ€è¦ç†è§£çš„æ˜¯ï¼ŒTypeScript ä½œä¸ºè¯­è¨€ï¼Œä»–åªå¤„ç†ä»£ç æ¨¡å—ã€‚å…¶ä»–ç±»å‹çš„æ–‡ä»¶è¿™ç§éä»£ç æ¨¡å—çš„å¯¼å…¥ï¼Œè®²é“ç†æ˜¯é€šè¿‡å¦å¤–çš„æ‰“åŒ…å·¥å…·æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ Web åº”ç”¨ä¸­çš„å›¾ç‰‡ï¼Œæ ·å¼ï¼ŒJSON è¿˜æœ‰ HTML æ¨¡æ¿æ–‡ä»¶ã€‚åªæ˜¯æˆ‘ä»¬éœ€è¦åœ¨ TypeScript å±‚é¢è§£å†³æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ã€‚</p>

<h2 id="é€šé…ç¬¦æ¨¡å—å£°æ˜">é€šé…ç¬¦æ¨¡å—å£°æ˜</h2>

<p>ç›´æ¥å¯¼å…¥éä»£ç æ¨¡å—ï¼ŒTypeScript ä¼šæŠ¥é”™ã€‚</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** ğŸš¨ Cannot find module './index.html'. */</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">html</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>TypeScript æ–‡æ¡£ä¸­å…³äºè¿™éƒ¨åˆ†çš„æè¿°æ˜¯ <a href="https://www.typescriptlang.org/docs/handbook/modules.html">Wildcard module declarations</a>ï¼Œå³é€šè¿‡å®šä¹‰é€šé…ç¬¦æ¨¡å—ã€‚ä¸ <a href="https://github.com/systemjs/systemjs/blob/master/docs/overview.md#plugin-syntax">SystemJS</a> å’Œ <a href="https://github.com/amdjs/amdjs-api/blob/master/LoaderPlugins.md">AMD</a> ä¸€è‡´ï¼Œåœ¨å¯¼å…¥æ—¶è·¯å¾„ä¸ŠåŠ ä¸Šå®šä¹‰å¥½çš„æ–‡ä»¶ç±»å‹å‰åç¼€ï¼Œè¿™äº›è·¯å¾„ä¸Šçš„é¢å¤–ä¿¡æ¯åœ¨ç¼–è¯‘åå¯é€šè¿‡è¿è¡Œæ—¶å®é™…çš„åŠ è½½å™¨ä¸­ç›¸åº”çš„æ’ä»¶æ¥è§£æå¤„ç†ã€‚</p>

<p><em>typings.d.ts</em></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">"</span><span class="s2">*!text</span><span class="dl">"</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">content</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">export</span> <span class="k">default</span> <span class="nx">content</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Some do it the other way around.</span>
<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">"</span><span class="s2">json!*</span><span class="dl">"</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">;</span>
    <span class="k">export</span> <span class="k">default</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><em>main.ts</em></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fileContent</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./xyz.txt!text</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">data</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">json!http://example.com/data.json</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">fileContent</span><span class="p">);</span>
</code></pre></div></div>

<p>ä½¿ç”¨å®šä¹‰ç±»å‹å‰åç¼€çš„æ–¹å¼æ˜¯å¯ä»¥è§£å†³ä»£ç ä¸­ TypeScript æŠ¥é”™çš„é—®é¢˜ï¼Œä½†ç¼–è¯‘åå› ä¸ºæ¨¡å—åœ°å€ä¸­çš„ç±»å‹å‰ç¼€æˆ–åç¼€ï¼ˆ<code class="language-plaintext highlighter-rouge">!text</code>,<code class="language-plaintext highlighter-rouge">json!</code>ï¼‰æ²¡æœ‰å»æ‰ï¼Œè¿™å°±éœ€è¦å¯¹ <code class="language-plaintext highlighter-rouge">require</code> å®šä¹‰ç›¸åº”çš„æ’ä»¶æ¥å¤„ç†ã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>node main.js
internal/modules/cjs/loader.js:670
    throw err<span class="p">;</span>
    ^

Error: Cannot find module <span class="s1">'./xyz.txt!text'</span>
</code></pre></div></div>

<p>å¦‚æœä½ çœ‹è¿‡ <a href="https://github.com/Microsoft/vscode/blob/master/src/vs/editor/browser/viewParts/selections/selections.ts#L6">VSCode çš„æºç </a>ï¼Œä¼šå‘ç°é‡Œé¢å¤§é‡ä½¿ç”¨äº†æœ‰ç±»ä¼¼è¿™æ ·çš„æ–¹å¼å¯¼å…¥æ ·å¼æ–‡ä»¶ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">'</span><span class="s1">vs/css!./selections</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>è¿™é‡Œ <code class="language-plaintext highlighter-rouge">vs/css!</code> ä¾¿æ˜¯ä¸Šé¢æåˆ°çš„æ–¹å¼ï¼Œä½† VSCode æ˜¯ä½¿ç”¨äº†<a href="https://github.com/Microsoft/vscode/blob/master/src/vs/loader.js#L1491">è‡ªå®šä¹‰</a>çš„ä¸€ä¸ªæ¨¡å—åŠ è½½å™¨ <a href="https://github.com/Microsoft/vscode-loader">Microsoft/vscode-loader</a> æ¥å¤„ç†ã€‚</p>

<p>è¿˜å¯ä»¥åƒä¸‹é¢è¿™æ ·æ¥è¿›è¡Œæ–‡ä»¶ç±»å‹çš„å£°æ˜ï¼š</p>

<p><em>typings.d.ts</em></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">"</span><span class="s2">*.html</span><span class="dl">"</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="k">export</span> <span class="k">default</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç„¶åå†™æ­£å¸¸çš„è·¯å¾„æ¥å¯¼å…¥å³å¯ï¼Œç¼–è¯‘åçš„äº§å‡ºä¸­è·¯å¾„æ²¡æœ‰æ”¹å˜ã€‚</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** âœ… ojbk */</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">html</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>å¯¹äºå…¶ä»–ç±»å‹çš„åç¼€åŒç†ã€‚</p>

<p><em>typings.d.ts</em></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">"</span><span class="s2">*.png</span><span class="dl">"</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="k">export</span> <span class="k">default</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">'</span><span class="s1">*.scss</span><span class="dl">'</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">content</span><span class="p">:</span> <span class="kr">any</span><span class="p">;</span>
  <span class="k">export</span> <span class="k">default</span> <span class="nx">content</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯è§£å†³äº† TypeScript çš„æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ï¼Œå®é™…æ–‡ä»¶çš„å¯¼å…¥å¹¶ä¸æ˜¯åœ¨ TypeScript ä¸­åšçš„ï¼Œè€Œéœ€è¦é¢å¤–çš„æ‰“åŒ…å·¥å…·ã€‚Webpack ä¸­åˆ™æ˜¯ç›¸åº”çš„æ ·å¼ loader å’Œ å›¾ç‰‡ loader æ¥è´Ÿè´£è¿™äº›æ–‡ä»¶çš„è§£æåŠ è½½ã€‚</p>

<h2 id="json-æ–‡ä»¶çš„å¯¼å…¥">JSON æ–‡ä»¶çš„å¯¼å…¥</h2>

<p>å› ä¸º JSON æ ¼å¼å¤ªè¿‡å¸¸è§ï¼ŒTypeScript ç¡®å®åœ¨è‡ªå·±çš„ç¼–è¯‘å™¨ä¸­æä¾›äº†å¯¹å…¶åŠ è½½çš„æ”¯æŒï¼Œé€šè¿‡ç›¸åº”çš„ç¼–è¯‘å‚æ•° <code class="language-plaintext highlighter-rouge">--resolveJsonModul</code> æ¥å¼€å¯ã€‚</p>

<p>åˆ›å»º <code class="language-plaintext highlighter-rouge">tsconfig.json</code> å¼€å¯å¯¹ JSON æ–‡ä»¶å¯¼å…¥çš„æ”¯æŒã€‚</p>

<p><em>tsconfig.json</em></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resolveJsonModule"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>ç„¶åä»£ç ä¸­å¯¼å…¥ JSON æ–‡ä»¶æ—¶æŒ‡å®šæ­£ç¡®çš„è·¯å¾„ï¼Œåƒå…¶ä»–æ­£å¸¸çš„ TypeScript æ¨¡å—ä¸€æ ·ã€‚æ— é¡»å‰ç¼€ï¼Œä¹Ÿæ— é¡»ç¼–å†™é¢å¤–çš„å£°æ˜æ–‡ä»¶ã€‚</p>

<p><em>main.ts</em></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">data</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./bar.json</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<p>å½“å°è¯•ç¼–è¯‘ä¸Šé¢ä»£ç æ—¶ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹çš„æŠ¥é”™ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tsc
error TS5055: Cannot write file <span class="s1">'/Users/wayou/Documents/dev/github/ts-wildcard-module/bar.json'</span> because it would overwrite input file.
</code></pre></div></div>

<p>å› ä¸ºç¼–è¯‘å JSON æ–‡ä»¶ä¹Ÿä¼šæœ‰ä¸€ä»½åŒåçš„äº§å‡ºï¼Œåœ¨æ²¡æœ‰æŒ‡å®šç¼–è¯‘è¾“å‡ºç›®å½•çš„æƒ…å†µä¸‹ï¼Œ tsc é»˜è®¤è¾“å‡ºåˆ°å½“å‰ç›®å½•ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸Šé¢ JSON æ–‡ä»¶ä¼šè¢«è¦†ç›–çš„æç¤ºã€‚æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯æ·»åŠ è¾“å‡ºç›®å½•çš„é…ç½®ã€‚</p>

<p><em>tsconfig.json</em></p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">{</span>
  "compilerOptions": {
    "target": "es5",
    "module": "commonjs",
    "resolveJsonModule": true,
<span class="gi">+    "outDir": "dist"
</span>  }
<span class="err">}</span>
</code></pre></div></div>

<p>å†æ¬¡ç¼–è¯‘åå¯æ­£å¸¸è¿è¡Œã€‚</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tsc
<span class="nv">$ </span>node dist/main.js
<span class="o">{</span> data: <span class="s1">'blah'</span> <span class="o">}</span>
</code></pre></div></div>

<p>é…åˆç€ <code class="language-plaintext highlighter-rouge">esModuleInterop</code> é€‰é¡¹å¯ä»¥è®©å¯¼å…¥æ›´åŠ ç®€æ´ã€‚</p>

<p><em>tsconfig.json</em></p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">{</span>
  "compilerOptions": {
    "target": "es5",
    "module": "commonjs",
<span class="gi">+    "esModuleInterop": true,
</span>    "resolveJsonModule": true,
    "outDir": "dist"
  }
<span class="err">}</span>
</code></pre></div></div>

<p><em>main.ts</em></p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- import * as data from "./bar.json";
</span><span class="gi">+ import data from "./bar.json";
</span><span class="p">console.log(data);
</span></code></pre></div></div>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>ä¸€èˆ¬é¡¹ç›®ä¸­éƒ½ä½¿ç”¨ä¸“é—¨çš„æ‰“åŒ…å·¥å…·æ¯”å¦‚ Webpackï¼ŒParcel ç­‰ï¼Œèµ„æºçš„è§£æåŠ è½½éƒ½ä¼šè¢«å¾ˆå¥½åœ°å¤„ç†ã€‚åªæ˜¯æˆ‘ä»¬éœ€è¦è§£å†³ TypeScipt æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ï¼Œæ­¤æ—¶å¯é€šè¿‡å¯¹ç›¸åº”æ–‡ä»¶ç¼–å†™å£°æ˜æ–‡ä»¶çš„æ–¹å¼ã€‚</p>

<h2 id="ç›¸å…³èµ„æº">ç›¸å…³èµ„æº</h2>

<ul>
  <li><a href="https://www.typescriptlang.org/docs/handbook/modules.html">Wildcard module declarations</a></li>
</ul>

:ET