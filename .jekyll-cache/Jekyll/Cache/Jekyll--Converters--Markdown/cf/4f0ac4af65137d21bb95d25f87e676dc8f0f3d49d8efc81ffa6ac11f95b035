I"Ø<h1 id="ios-å¾®ä¿¡ä¸­éŸ³é¢‘-preload-çš„é—®é¢˜">iOS å¾®ä¿¡ä¸­éŸ³é¢‘ preload çš„é—®é¢˜</h1>

<p>å¾®ä¿¡ä¸­ audio <code class="language-plaintext highlighter-rouge">preload</code> å¹¶ä¸å¥½ç”¨ï¼Œä¸ç¡®å®šæ˜¯æ–°ç‰ˆæœ¬ä¸­ x5 æµè§ˆå™¨å†…æ ¸æœ‰å˜æ›´çš„åŸå› ã€‚</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³è¦å±•ç¤ºéŸ³é¢‘çš„æ—¶é•¿ï¼Œåªéœ€è¦è®¾ç½® <code class="language-plaintext highlighter-rouge">preload=â€˜metadataâ€™</code> å³å¯ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
  <span class="nx">player</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">metadata</span><span class="dl">"</span><span class="p">;</span>
  <span class="nx">player</span><span class="p">.</span><span class="nx">onloadedmetadata</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">duration</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
  <span class="p">};</span>
</code></pre></div></div>

<p>å¾®ä¿¡ä¸­ä¸ç”Ÿæ•ˆã€‚è§£å†³åŠæ³•æ˜¯æ·»åŠ å¾®ä¿¡çš„ web sdkï¼Œç„¶åç›‘å¬ <code class="language-plaintext highlighter-rouge">WeixinJSBridgeReady</code> äº‹ä»¶ï¼Œåœ¨è¯¥äº‹ä»¶çš„å›è°ƒä¸­æ‰‹åŠ¨è°ƒç”¨ <code class="language-plaintext highlighter-rouge">load</code> å³å¯ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">WeixinJSBridgeReady</span><span class="dl">"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="kc">false</span>
  <span class="p">);</span>
</code></pre></div></div>

<p>å¯¹äºè§†é¢‘åŒç†ã€‚é€šè¿‡åœ¨ <code class="language-plaintext highlighter-rouge">WeixinJSBridgeReady</code> å›è°ƒä¸­æ‰‹åŠ¨è°ƒç”¨ <code class="language-plaintext highlighter-rouge">load</code> å¯é¢„åŠ è½½èµ„æºè§†é¢‘å¯é€šè¿‡è¯¥æ–¹æ³•åŠ è½½å‡ºç¬¬ä¸€å¸§ä½œä¸ºå°é¢ã€‚</p>

<p>å¦‚æœè¦å®ç°è‡ªåŠ¨æ’­æ”¾ï¼ŒiOS åŠå¾®ä¿¡ä¸­ä¹Ÿæ˜¯é™åˆ¶å¾ˆå¤šã€‚é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œåªéœ€å°† <code class="language-plaintext highlighter-rouge">load</code> æ¢æˆ <code class="language-plaintext highlighter-rouge">play</code> å³å¯ã€‚</p>

<p><a href="https://wayou.github.io/posts/wechat-audio-preload-issue/index.html">ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹ç¤ºä¾‹</a></p>

:ET