<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="notes about the coding life">
    <meta name="keywords"  content="牛哇勇, 博客, 互联网, Web, JavaScript, 前端, 设计">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="「SF-LC」4 Poly - 牛さんの部落格|刘哇勇的部落格">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="
  The critical new ideas are 
polymorphism (abstracting functions over the types of the data they manipulate) and 
higher-order functions (treating functions as data).

">
    
    <meta property="article:published_time" content="2019-01-04T00:00:00Z">
    
    
    <meta property="article:author" content="Hux">
    
    
    <meta property="article:tag" content="LF (逻辑基础)">
    
    <meta property="article:tag" content="SF (软件基础)">
    
    <meta property="article:tag" content="Coq">
    
    <meta property="article:tag" content="笔记">
    
    
    <meta property="og:image" content="http://0.0.0.0:4000">
    <meta property="og:url" content="http://0.0.0.0:4000/2019/01/04/sf-lf-04-poly/">
    <meta property="og:site_name" content="牛さんの部落格|刘哇勇的部落格">
    
    <title>「SF-LC」4 Poly - 牛さんの部落格|刘哇勇的部落格</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://0.0.0.0:4000/2019/01/04/sf-lf-04-poly/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


  <!-- hack iOS CSS :active style -->
  <body ontouchstart="">
    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
    
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">牛さんの部落格</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/">Home</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="/about/">关于</a>
                        </li>
                        
                        
                        
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#huxblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __HuxNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __HuxNav__.close()
            } else {
                __HuxNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close HuxNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __HuxNav__.close();
        })
    </script> <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div> <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg.jpg');
        background: ;
    }

    
</style>

<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=LF+%28%E9%80%BB%E8%BE%91%E5%9F%BA%E7%A1%80%29" title="LF (逻辑基础)">LF (逻辑基础)</a>
                        
                        <a class="tag" href="/archive/?tag=SF+%28%E8%BD%AF%E4%BB%B6%E5%9F%BA%E7%A1%80%29" title="SF (软件基础)">SF (软件基础)</a>
                        
                        <a class="tag" href="/archive/?tag=Coq" title="Coq">Coq</a>
                        
                        <a class="tag" href="/archive/?tag=%E7%AC%94%E8%AE%B0" title="笔记">笔记</a>
                        
                    </div>
                    <h1>「SF-LC」4 Poly</h1>
                    
                    <h2 class="subheading">Logical Foundations - Polymorphism and Higher-Order Functions</h2>
                    <span class="meta">Posted by Hux on January 4, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<blockquote>
  <p>The critical new ideas are 
polymorphism (abstracting functions over the types of the data they manipulate) and 
higher-order functions (treating functions as data).</p>
</blockquote>

<h2 id="polymorphism">Polymorphism</h2>

<p>Until today, We were living in the monomorphic world of Coq. 
So if we want a list, we have to define it for each type:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">boollist</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">bool_nil</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">bool_cons</span><span class="w"> </span><span class="o">(</span><span class="no">b</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">boollist</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<h2 id="polymorphic-type-and-constructors">Polymorphic Type and Constructors</h2>

<p>But of course Coq supports polymorphic type.
So we can <em>abstract things over type</em></p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="p">:</span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">nil</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">).</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="no">list</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; list : Type -&gt; Type *)</span><span class="w">
</span></code></pre></div></div>

<p>Recall from PLT course, this is exacly <strong>Parametric Polymorphism</strong> 
and it’s <strong>SystemFω</strong>. the <code class="language-plaintext highlighter-rouge">list</code> here is a type-level small lambda, or <strong>type operators</strong></p>

<p>Another things I’d love to mention is the concrete syntax of <code class="language-plaintext highlighter-rouge">list X</code>,
it didn’t choose the SML/OCaml order but the Haskell order.</p>

<h3 id="q1-whats-the-type-of-nil-and-cons">Q1. What’s the type of <code class="language-plaintext highlighter-rouge">nil</code> and <code class="language-plaintext highlighter-rouge">cons</code>?</h3>

<p>Both having <code class="language-plaintext highlighter-rouge">forall</code> type</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; nil : forall X : Type, list X *)</span><span class="w">
</span><span class="k">Check</span><span class="w"> </span><span class="no">cons</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; nil : forall X : Type, X -&gt; list X -&gt; list X *)</span><span class="w">
</span></code></pre></div></div>

<h3 id="q2-whats-the-type-of-list-nat-why-not-type-but-weird-set">Q2. What’s the type of <code class="language-plaintext highlighter-rouge">list nat</code>? Why not <code class="language-plaintext highlighter-rouge">Type</code> but weird <code class="language-plaintext highlighter-rouge">Set</code>?</h3>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="no">nat</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; nat : Set *)</span><span class="w">
</span><span class="k">Check</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">nat</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; list nat : Set *)</span><span class="w">
</span><span class="k">Check</span><span class="w"> </span><span class="kr">Set</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; Set: Type *)</span><span class="w">
</span><span class="k">Check</span><span class="w"> </span><span class="kr">Type</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; Type: Type *)</span><span class="w">
</span></code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">(</span><span class="no">nil</span><span class="w"> </span><span class="no">nat</span><span class="o">))).</span><span class="w">
</span></code></pre></div></div>

<h2 id="polymorphic-functions">Polymorphic Functions</h2>

<p>we can make polymorphic versions of list-processing function:</p>

<p>Btw, Pierce follows the TAPL convention where type is written in capital letter but not greek letter, 
less clear in first look but better for typing in real programming.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="kp">repeat</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="no">X</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">count'</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">(</span><span class="kp">repeat</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count'</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>This is <em>SystemF</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Check repeat.
(* ===&gt; repeat : forall X : Type, X -&gt; nat -&gt; list X *)
</code></pre></div></div>

<h2 id="slide-qa">Slide QA</h2>

<ol>
  <li>ill-typed</li>
  <li><code class="language-plaintext highlighter-rouge">forall X : Type, X -&gt; nat -&gt; list X</code></li>
  <li><code class="language-plaintext highlighter-rouge">list nat</code></li>
</ol>

<h2 id="type-argument-inference">Type Argument Inference</h2>

<p><code class="language-plaintext highlighter-rouge">X</code> must be a <code class="language-plaintext highlighter-rouge">Type</code> since <code class="language-plaintext highlighter-rouge">nil</code> expects an <code class="language-plaintext highlighter-rouge">Type</code> as its first argument.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">repeat'</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">     </span><span class="c">(* return type [:list X] can be omitted as well *)</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="no">X</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">count'</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">(</span><span class="no">repeat'</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count'</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="no">repeat'</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; forall X : Type, X -&gt; nat -&gt; list X *)</span><span class="w">
</span></code></pre></div></div>

<h2 id="type-argument-synthesis">Type Argument Synthesis</h2>

<p>We can write <code class="language-plaintext highlighter-rouge">_</code> (hole) in place of <code class="language-plaintext highlighter-rouge">X</code> and Coq will try to <strong>unify</strong> all local information.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">repeat''</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="p">_</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">count'</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">(</span><span class="no">repeat''</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count'</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">list123'</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="no">cons</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">(</span><span class="no">nil</span><span class="w"> </span><span class="p">_</span><span class="o">))).</span><span class="w">
</span></code></pre></div></div>

<p>Same underlying mechanisms:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">repeat'</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
</span><span class="no">repeat'</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">_</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">_</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">_</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
</span></code></pre></div></div>

<h2 id="implicit-arguments">Implicit Arguments</h2>

<p>Using <code class="language-plaintext highlighter-rouge">Arguments</code> directives to tell if an argument need to be implicit (i.e. omitted and always to infer) or not.</p>

<blockquote>
  <p>Implicitly convert to <code class="language-plaintext highlighter-rouge">_</code> (synthesis) by frontend.</p>
</blockquote>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Arguments</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}.</span><span class="w">
</span><span class="k">Arguments</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="p">_</span><span class="o">.</span><span class="w">       </span><span class="c">(* data constructor usually don't specify the name *)</span><span class="w">
</span><span class="k">Arguments</span><span class="w"> </span><span class="kp">repeat</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count</span><span class="pi">.</span><span class="w"> </span><span class="c">(* fun definition usually do *)</span><span class="w">
</span></code></pre></div></div>

<p>The even more convenient syntax is that we can declare them right in our function definition.
Just <em>surrounding them with curly braces</em>.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">repeat'''</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">count</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">count</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">nil</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="no">count'</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">cons</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">(</span><span class="no">repeat'''</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">count'</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="implicit-arguments-pitfalls-on-inductive">Implicit Arguments Pitfalls on <code class="language-plaintext highlighter-rouge">Inductive</code></h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">list'</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="p">:</span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">nil'</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">cons'</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list'</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>Doing this will make <code class="language-plaintext highlighter-rouge">X</code> implicit for even <code class="language-plaintext highlighter-rouge">list'</code>, the type constructor itself…</p>

<h2 id="other-polymorphic-list-functions">Other Polymorphic List functions</h2>

<p>No difference but add implicit type argument <code class="language-plaintext highlighter-rouge">{X : Type}</code>.</p>

<h2 id="supplying-type-arguments-explicitly">Supplying Type Arguments Explicitly</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fail</span><span class="w"> </span><span class="k">Definition</span><span class="w"> </span><span class="no">mynil</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">mynil</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">nat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="o">@</span><span class="no">nil</span><span class="pi">.</span><span class="w"> </span><span class="c">(* ===&gt; @nil : forall X : Type, list X *)</span><span class="w">
</span><span class="k">Definition</span><span class="w"> </span><span class="no">mynil'</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="no">nil</span><span class="w"> </span><span class="no">nat</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>First thought: Existential
Second thought: A wait to be unified Universal. (after being implicit and require inference)</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">

</span><span class="no">nil</span><span class="w"> </span><span class="p">:</span><span class="w"> 
   </span><span class="no">list</span><span class="w"> </span><span class="nv">?X</span><span class="w">
</span><span class="no">where</span><span class="w"> </span><span class="nv">?X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="kr">Type</span><span class="o">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="list-notation">List notation</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Notation</span><span class="w"> </span><span class="s2">"x :: y"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="o">)</span><span class="w">
                     </span><span class="o">(</span><span class="kp">at</span><span class="w"> </span><span class="no">level</span><span class="w"> </span><span class="mi">60</span><span class="o">,</span><span class="w"> </span><span class="no">right</span><span class="w"> </span><span class="no">associativity</span><span class="o">).</span><span class="w">
</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"[ ]"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">nil</span><span class="pi">.</span><span class="w">
</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"[ x ; .. ; y ]"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="o">(</span><span class="no">cons</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="o">[])</span><span class="w"> </span><span class="o">..).</span><span class="w">
</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"x ++ y"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">app</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="o">)</span><span class="w">
                     </span><span class="o">(</span><span class="kp">at</span><span class="w"> </span><span class="no">level</span><span class="w"> </span><span class="mi">60</span><span class="o">,</span><span class="w"> </span><span class="no">right</span><span class="w"> </span><span class="no">associativity</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>Same with before thanks to the implicit argument</p>

<h2 id="slide-qa-2">Slide Q&amp;A 2</h2>

<ol>
  <li>we use <code class="language-plaintext highlighter-rouge">;</code> not <code class="language-plaintext highlighter-rouge">,</code>!!</li>
  <li><code class="language-plaintext highlighter-rouge">list nat</code></li>
  <li>ill-typed</li>
  <li>ill-typed</li>
  <li><code class="language-plaintext highlighter-rouge">list (list nat)</code></li>
  <li><code class="language-plaintext highlighter-rouge">list (list nat)</code> (tricky in first look)</li>
  <li><code class="language-plaintext highlighter-rouge">list bool</code></li>
  <li>ill-typed</li>
  <li>ill-typed</li>
</ol>

<h2 id="poly-pair">Poly Pair</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">prod</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="no">pair</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Y</span><span class="o">).</span><span class="w">
</span><span class="k">Arguments</span><span class="w"> </span><span class="no">pair</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}</span><span class="w"> </span><span class="o">{</span><span class="no">Y</span><span class="o">}</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="p">_</span><span class="o">.</span><span class="w">  </span><span class="c">(* omit two type var **)</span><span class="w">

</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"( x , y )"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">pair</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="o">).</span><span class="w">
</span><span class="k">Notation</span><span class="w"> </span><span class="s2">"X * Y"</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="no">prod</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">type_scope</span><span class="pi">.</span><span class="w">  </span><span class="c">(* only be used when parsing type, avoids clashing with multiplication *)</span><span class="w">
</span></code></pre></div></div>

<p>Be careful of <code class="language-plaintext highlighter-rouge">(X,Y)</code> and <code class="language-plaintext highlighter-rouge">X*Y</code>. Coq pick the ML way, not haskell way.</p>

<h2 id="combine-or-zip"><code class="language-plaintext highlighter-rouge">Combine</code> or <code class="language-plaintext highlighter-rouge">Zip</code></h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">combine</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">lx</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">ly</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w">
           </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="o">*</span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">lx</span><span class="o">,</span><span class="w"> </span><span class="no">ly</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[],</span><span class="w"> </span><span class="p">_</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">[]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="p">_</span><span class="o">,</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">[]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">tx</span><span class="o">,</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">ty</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="o">,</span><span class="w"> </span><span class="no">y</span><span class="o">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="o">(</span><span class="no">combine</span><span class="w"> </span><span class="no">tx</span><span class="w"> </span><span class="no">ty</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Guess type?</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="o">@</span><span class="no">combine</span><span class="pi">.</span><span class="w">
</span><span class="o">@</span><span class="no">combine</span><span class="w">
     </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">,</span><span class="w">
       </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w">

</span><span class="c">(* A special form of `forall`? *)</span><span class="w">
</span><span class="k">Check</span><span class="w"> </span><span class="no">combine</span><span class="pi">.</span><span class="w">
</span><span class="no">combine</span><span class="w">
     </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="nv">?X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="nv">?Y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="o">(</span><span class="nv">?X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">?Y</span><span class="o">)</span><span class="w">
</span><span class="no">where</span><span class="w">
</span><span class="nv">?X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="kr">Type</span><span class="o">]</span><span class="w">
</span><span class="nv">?Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="kr">Type</span><span class="o">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="poly-option">Poly Option</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Inductive</span><span class="w"> </span><span class="no">option</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="p">:</span><span class="kr">Type</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">Some</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">None</span><span class="pi">.</span><span class="w">

</span><span class="k">Arguments</span><span class="w"> </span><span class="no">Some</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}</span><span class="w"> </span><span class="p">_</span><span class="o">.</span><span class="w">
</span><span class="k">Arguments</span><span class="w"> </span><span class="no">None</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="o">}.</span><span class="w">


</span><span class="c">(* find nth element if exist, None otherwise *)</span><span class="w">
</span><span class="k">Fixpoint</span><span class="w"> </span><span class="no">nth_error</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">option</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">None</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">=?</span><span class="w"> </span><span class="no">O</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="no">Some</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="no">nth_error</span><span class="w"> </span><span class="no">l'</span><span class="w"> </span><span class="o">(</span><span class="no">pred</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="function-as-data">Function as data</h2>

<p><em>Functions as first-class citizens</em></p>

<h2 id="higher-order-functions">Higher-Order Functions</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">doit3times</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="p">:</span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="p">:</span><span class="no">X</span><span class="p">→</span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="p">:</span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="no">f</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="no">n</span><span class="o">)).</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="o">@</span><span class="no">doit3times</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ===&gt; doit3times : forall X : Type, (X -&gt; X) -&gt; X -&gt; X *)</span><span class="w">
</span></code></pre></div></div>

<h2 id="filter-taking-a-predicate-on-x">Filter (taking a <em>predicate</em> on <code class="language-plaintext highlighter-rouge">X</code>)</h2>

<p><em>collection-oriented</em> programming style - my first time seeing this, any comments?</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">filter</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="p">:</span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">test</span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="p">→</span><span class="no">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="p">:</span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w">
                </span><span class="p">:</span><span class="w"> </span><span class="o">(</span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">[]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="no">test</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="o">(</span><span class="no">filter</span><span class="w"> </span><span class="no">test</span><span class="w"> </span><span class="no">t</span><span class="o">)</span><span class="w">
                        </span><span class="kr">else</span><span class="w"> </span><span class="no">filter</span><span class="w"> </span><span class="no">test</span><span class="w"> </span><span class="no">t</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">

</span><span class="k">Example</span><span class="w"> </span><span class="no">test_filter1</span><span class="p">:</span><span class="w"> </span><span class="no">filter</span><span class="w"> </span><span class="no">evenb</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="mi">3</span><span class="p">;</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="mi">2</span><span class="p">;</span><span class="mi">4</span><span class="o">].</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w"> </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h2 id="anonymous-functions">Anonymous Functions</h2>

<blockquote>
  <p>It is arguably a little sad, in the example just above, to be forced to define the function length_is_1 and give it a name just to be able to pass it as an argument to filter</p>
</blockquote>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Example</span><span class="w"> </span><span class="no">test_anon_fun'</span><span class="p">:</span><span class="w">
  </span><span class="no">doit3times</span><span class="w"> </span><span class="o">(</span><span class="kr">fun</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="no">n</span><span class="o">)</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="o">.</span><span class="w">
</span><span class="k">Proof</span><span class="pi">.</span><span class="w"> </span><span class="ne">reflexivity</span><span class="pi">.</span><span class="w"> </span><span class="k">Qed</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Syntax: hybrid of OCaml <code class="language-plaintext highlighter-rouge">fun n -&gt; n</code> and SML <code class="language-plaintext highlighter-rouge">fn n =&gt; n</code>.
and support multi-arguments (curried)</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Compute</span><span class="w"> </span><span class="o">((</span><span class="kr">fun</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="no">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">y</span><span class="o">)</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<h2 id="map">Map</h2>

<p>Should be familar.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="p">:</span><span class="no">X</span><span class="p">→</span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="p">:</span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">(</span><span class="no">list</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">[]</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="no">h</span><span class="o">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="o">(</span><span class="no">map</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="no">t</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="o">@</span><span class="no">map</span><span class="w">

</span><span class="o">@</span><span class="no">map</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">,</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">Y</span><span class="w">
</span></code></pre></div></div>

<h2 id="slide-qa-3">Slide Q&amp;A 3</h2>

<ol>
  <li>as above</li>
</ol>

<h2 id="option-map"><code class="language-plaintext highlighter-rouge">option</code> map</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">option_map</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">→</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">xo</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">option</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">option</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">xo</span><span class="w"> </span><span class="kp">with</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">None</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">None</span><span class="w">
    </span><span class="o">|</span><span class="w"> </span><span class="no">Some</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">Some</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="w"> </span><span class="no">x</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Functor Map (<code class="language-plaintext highlighter-rouge">fmap</code>) !</p>

<h2 id="fold-reduce">Fold (Reduce)</h2>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Fixpoint</span><span class="w"> </span><span class="kp">fold</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">f</span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="p">→</span><span class="no">Y</span><span class="p">→</span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">l</span><span class="p">:</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">b</span><span class="p">:</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">match</span><span class="w"> </span><span class="no">l</span><span class="w"> </span><span class="kp">with</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">b</span><span class="w">
  </span><span class="o">|</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="no">h</span><span class="w"> </span><span class="o">(</span><span class="kp">fold</span><span class="w"> </span><span class="no">f</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="no">b</span><span class="o">)</span><span class="w">
  </span><span class="kr">end</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>Fold Right (<code class="language-plaintext highlighter-rouge">foldr</code>). Argument order same with OCaml, different with Haskell.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="o">@</span><span class="kp">fold</span><span class="w">

</span><span class="o">@</span><span class="kp">fold</span><span class="w">
     </span><span class="p">:</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">,</span><span class="w">
       </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Y</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">list</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">Y</span><span class="w">
</span></code></pre></div></div>

<h2 id="slide-qa-4">Slide Q&amp;A 4</h2>

<ol>
  <li>as above (type can be simply readed out)</li>
  <li><code class="language-plaintext highlighter-rouge">list nat -&gt; nat -&gt; nat</code></li>
  <li>10</li>
</ol>

<h2 id="functions-that-construct-functions">Functions That Construct Functions</h2>

<p>Should be familar.
Use of <em>closure</em>.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">definition</span><span class="w"> </span><span class="no">constfun</span><span class="w"> </span><span class="o">{</span><span class="no">X</span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">x</span><span class="p">:</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">nat</span><span class="p">→</span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="o">(</span><span class="no">k</span><span class="p">:</span><span class="no">nat</span><span class="o">)</span><span class="w"> </span><span class="p">⇒</span><span class="w"> </span><span class="no">x</span><span class="pi">.</span><span class="w">

</span><span class="k">Definition</span><span class="w"> </span><span class="no">ftrue</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">constfun</span><span class="w"> </span><span class="no">true</span><span class="pi">.</span><span class="w">
</span><span class="k">Example</span><span class="w"> </span><span class="no">constfun_example1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">ftrue</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="pi">.</span><span class="w">

</span><span class="k">Example</span><span class="w"> </span><span class="no">constfun_example2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">(</span><span class="no">constfun</span><span class="w"> </span><span class="mi">5</span><span class="o">)</span><span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="o">.</span><span class="w">
</span></code></pre></div></div>

<p><strong>Curried</strong> and <strong>partial application</strong></p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Check</span><span class="w"> </span><span class="no">plus</span><span class="pi">.</span><span class="w">
</span><span class="c">(* ==&gt; nat -&gt; nat -&gt; nat *)</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="no">plus</span><span class="w"> </span><span class="mi">3</span><span class="o">.</span><span class="w">
</span><span class="c">(* ==&gt; nat -&gt; nat *)</span><span class="w">
</span></code></pre></div></div>

<h2 id="universe-inconsistency">Universe Inconsistency</h2>

<p>I encounter this problem when doing church numeral exercise.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">plus</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="no">succ</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<p>will result in <code class="language-plaintext highlighter-rouge">universe inconsistency</code> error.</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Set</span><span class="w"> </span><span class="k">Printing</span><span class="w"> </span><span class="k">Universes</span><span class="pi">.</span><span class="w"> </span><span class="c">(* giving more error msg *)</span><span class="w">

</span><span class="no">In</span><span class="w"> </span><span class="no">environment</span><span class="w">
</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w">
</span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w">
</span><span class="no">The</span><span class="w"> </span><span class="no">term</span><span class="w"> </span><span class="s2">"cnat"</span><span class="w"> </span><span class="no">has</span><span class="w"> </span><span class="no">type</span><span class="w"> </span><span class="s2">"Type@{Top.168+1}"</span><span class="w"> </span><span class="no">while</span><span class="w"> </span><span class="no">it</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">expected</span><span class="w"> </span><span class="no">to</span><span class="w"> </span><span class="no">have</span><span class="w"> </span><span class="no">type</span><span class="w"> </span><span class="s2">"Type@{Top.168}"</span><span class="w">
</span><span class="o">(</span><span class="no">universe</span><span class="w"> </span><span class="no">inconsistency</span><span class="p">:</span><span class="w"> </span><span class="no">Cannot</span><span class="w"> </span><span class="no">enforce</span><span class="w"> </span><span class="no">Top</span><span class="o">.</span><span class="mi">168</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">Top</span><span class="o">.</span><span class="mi">168</span><span class="w"> </span><span class="no">because</span><span class="w"> </span><span class="no">Top</span><span class="o">.</span><span class="mi">168</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">Top</span><span class="o">.</span><span class="mi">168</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<h3 id="whats-happening">What’s happening?</h3>

<blockquote>
  <p>Yes, you can define: <code class="language-plaintext highlighter-rouge">Definition plus (n m : cnat) : cnat := n cnat succ m.</code> in System F.  However, in Coq’s richer logic, you need to be a little more careful about allowing types to be instantiated at their own types, else you run into issue of inconsistency. Essentially, there is a stratification of types (by “universes”) that says that one universe cannot contain a “bigger” universe. Often, things are polymorphic in their universe (i.e., work in all universes), you run into this where you cannot instantiate the “forall X, …” that is the definition of cnat by cnat itself.
– Prof. Fluet</p>
</blockquote>

<h3 id="httpsstackoverflowcomquestions32153710what-does-error-universe-inconsistency-mean-in-coq"><a href="https://stackoverflow.com/questions/32153710/what-does-error-universe-inconsistency-mean-in-coq">https://stackoverflow.com/questions/32153710/what-does-error-universe-inconsistency-mean-in-coq</a></h3>

<p><code class="language-plaintext highlighter-rouge">Check Type =&gt; Type</code> is a bit of a lie, everytime it the <code class="language-plaintext highlighter-rouge">Type</code> is not that same, but <strong>a bigger one</strong>.</p>

<blockquote>
  <p>Formally, every Type has an index associated to it, called its <em>universe level</em>.</p>
</blockquote>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Set</span><span class="w"> </span><span class="k">Printing</span><span class="w"> </span><span class="k">Universes</span><span class="pi">.</span><span class="w"> </span><span class="c">(* giving more error msg *)</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="kr">Type</span><span class="pi">.</span><span class="w"> 
</span><span class="kr">Type</span><span class="o">@{</span><span class="no">Top</span><span class="o">.</span><span class="mi">1</span><span class="o">}</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">@{</span><span class="no">Top</span><span class="o">.</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">}</span><span class="w"> </span><span class="c">(* {Top.1} |=  *)</span><span class="w">

</span><span class="k">Check</span><span class="w"> </span><span class="kr">Type</span><span class="pi">.</span><span class="w"> 
</span><span class="kr">Type</span><span class="o">@{</span><span class="no">Top</span><span class="o">.</span><span class="mi">2</span><span class="o">}</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">@{</span><span class="no">Top</span><span class="o">.</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="o">}</span><span class="w"> </span><span class="c">(* {Top.2} |=  *)</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>Thus, the correct answer for that question is that <code class="language-plaintext highlighter-rouge">Type_i</code> has type <code class="language-plaintext highlighter-rouge">Type_j</code>, for any index <code class="language-plaintext highlighter-rouge">j &gt; i</code>. This is needed to ensure the consistency of Coq’s theory: <em>if there were only one Type, it would be possible to show a contradiction, similarly to how one gets a contradiction in set theory if you assume that there is a set of all sets.</em>
Coq generates one new index variable every time you write Type, and keeps track of internal constraints</p>
</blockquote>

<blockquote>
  <p>The error message you saw means that <em>Coq’s constraint solver</em> for universe levels says that there can’t be a solution to the constraint system you asked for.</p>
</blockquote>

<blockquote>
  <p>The problem is that the <code class="language-plaintext highlighter-rouge">forall</code> in the definition of <code class="language-plaintext highlighter-rouge">nat</code> is quantified over <code class="language-plaintext highlighter-rouge">Type_i</code>, but Coq’s logic forces <code class="language-plaintext highlighter-rouge">nat</code> to be itself of type <code class="language-plaintext highlighter-rouge">Type_j</code>, with <code class="language-plaintext highlighter-rouge">j &gt; i</code>. On the other hand, the application <code class="language-plaintext highlighter-rouge">n nat</code> requires that <code class="language-plaintext highlighter-rouge">j &lt;= i</code>, resulting in a non-satisfiable set of index constraints.</p>
</blockquote>

<p>From my understanding, the essences are:</p>

<ol>
  <li>reasons: Allowing self-application introduces <em>logic contradiction (paradox)</em>.</li>
  <li>understanding: The <code class="language-plaintext highlighter-rouge">forall</code> is quantified over <em>types in the previous universe</em> (the universe w/o itself).</li>
</ol>

<h3 id="from-httpscoqinriafrrefmanaddendumuniverse-polymorphismhtml">From <a href="https://coq.inria.fr/refman/addendum/universe-polymorphism.html">https://coq.inria.fr/refman/addendum/universe-polymorphism.html</a></h3>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">identity</span><span class="w"> </span><span class="o">{</span><span class="no">A</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="no">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">A</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">a</span><span class="pi">.</span><span class="w">

</span><span class="no">Fail</span><span class="w"> </span><span class="k">Definition</span><span class="w"> </span><span class="no">selfid</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="no">identity</span><span class="w"> </span><span class="o">(@</span><span class="no">identity</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">The</span><span class="w"> </span><span class="no">command</span><span class="w"> </span><span class="no">has</span><span class="w"> </span><span class="no">indeed</span><span class="w"> </span><span class="no">failed</span><span class="w"> </span><span class="kp">with</span><span class="w"> </span><span class="no">message</span><span class="p">:</span><span class="w">
</span><span class="no">The</span><span class="w"> </span><span class="no">term</span><span class="w"> </span><span class="s2">"@identity"</span><span class="w"> </span><span class="no">has</span><span class="w"> </span><span class="no">type</span><span class="w"> </span><span class="s2">"forall A : Type, A -&gt; A"</span><span class="w">
</span><span class="no">while</span><span class="w"> </span><span class="no">it</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">expected</span><span class="w"> </span><span class="no">to</span><span class="w"> </span><span class="no">have</span><span class="w"> </span><span class="no">type</span><span class="w"> </span><span class="s2">"?A"</span><span class="w">
</span><span class="o">(</span><span class="no">unable</span><span class="w"> </span><span class="no">to</span><span class="w"> </span><span class="no">find</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">well</span><span class="o">-</span><span class="no">typed</span><span class="w"> </span><span class="no">instantiation</span><span class="w"> </span><span class="no">for</span><span class="w"> </span><span class="s2">"?A"</span><span class="p">:</span><span class="w"> </span><span class="no">cannot</span><span class="w"> </span><span class="no">ensure</span><span class="w"> </span><span class="no">that</span><span class="w">
</span><span class="s2">"Type@{Top.1+1}"</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">a</span><span class="w"> </span><span class="no">subtype</span><span class="w"> </span><span class="no">of</span><span class="w"> </span><span class="s2">"Type@{Top.1}"</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<p>The link also introduce some advanced/experimental way to do <em>polymorphic universe</em></p>

<h2 id="polymorphic-church-numerals-wo-self-applying-itself">Polymorphic Church Numerals w/o self-applying itself</h2>

<blockquote>
  <p>References: <a href="https://en.wikipedia.org/wiki/Church_encoding">https://en.wikipedia.org/wiki/Church_encoding</a></p>
</blockquote>

<h3 id="definition">Definition</h3>

<p>Untyped doesn’t need to declare type…
STLC doesn’t have enough expressive power to represent church encoding
System F definition:</p>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="kr">forall</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kr">Type</span><span class="o">,</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">X</span><span class="pi">.</span><span class="w">
</span></code></pre></div></div>

<h3 id="succ"><code class="language-plaintext highlighter-rouge">succ</code></h3>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">succ</span> <span class="o">=</span> <span class="nf">\</span><span class="n">n</span> <span class="n">s</span> <span class="n">z</span> <span class="o">-&gt;</span> <span class="n">s</span> <span class="p">(</span><span class="n">n</span> <span class="n">s</span> <span class="n">z</span><span class="p">)</span> 
</code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">succ</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">z</span><span class="o">).</span><span class="w">
</span></code></pre></div></div>

<h3 id="plus"><code class="language-plaintext highlighter-rouge">plus</code></h3>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plus</span> <span class="o">=</span> <span class="nf">\</span><span class="n">m</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="n">scc</span> <span class="n">n</span>
<span class="n">plus</span> <span class="o">=</span> <span class="nf">\</span><span class="n">m</span> <span class="n">n</span> <span class="n">s</span> <span class="n">z</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="n">s</span> <span class="p">(</span><span class="n">n</span> <span class="n">s</span> <span class="n">z</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">plus</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="no">succ</span><span class="w"> </span><span class="no">m</span><span class="pi">.</span><span class="w">                </span><span class="c">(* System F *)</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">n</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="o">(</span><span class="no">m</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">z</span><span class="o">).</span><span class="w"> </span><span class="c">(* Coq *)</span><span class="w">
</span></code></pre></div></div>

<pre><code class="language-f(TAPL)">plus = 
  lambda m:CNat.
  lambda n:CNat. ( 
    lambda X.
    lambda s:X-&gt;X.
    lambda z:X. 
      m [X] s (n [X] s z)
  ) as CNat;

plus = 
  lambda m:CNat.
  lambda n:CNat. 
    m [CNat] succ' n;
</code></pre>

<h3 id="mult"><code class="language-plaintext highlighter-rouge">mult</code></h3>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mult</span> <span class="o">=</span> <span class="nf">\</span><span class="n">m</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="p">(</span><span class="n">plus</span> <span class="n">n</span><span class="p">)</span> <span class="n">n0</span> 
</code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">mult</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="o">(</span><span class="no">plus</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="no">zero</span><span class="pi">.</span><span class="w">         </span><span class="c">(* SystemF *)</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="w"> </span><span class="no">z</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">(</span><span class="no">m</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="no">s</span><span class="o">)</span><span class="w"> </span><span class="no">z</span><span class="o">).</span><span class="w"> </span><span class="c">(* Coq *)</span><span class="w">
</span></code></pre></div></div>

<pre><code class="language-f(TAPL)">mult = 
  lambda m:CNat.
  lambda n:CNat. 
    m [CNat] (plus n) c0;   /* partial app `plus` */
</code></pre>

<h3 id="exp"><code class="language-plaintext highlighter-rouge">exp</code></h3>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pow</span> <span class="o">=</span> <span class="nf">\</span><span class="n">m</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="p">(</span><span class="n">mult</span> <span class="n">n</span><span class="p">)</span> <span class="n">n1</span>
<span class="n">exp</span> <span class="o">=</span> <span class="nf">\</span><span class="n">m</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="n">m</span>
</code></pre></div></div>

<div class="language-coq highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Definition</span><span class="w"> </span><span class="no">exp</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="o">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w">
  </span><span class="no">n</span><span class="w"> </span><span class="no">cnat</span><span class="w"> </span><span class="o">(</span><span class="no">mult</span><span class="w"> </span><span class="no">m</span><span class="o">)</span><span class="w"> </span><span class="no">one</span><span class="w">         </span><span class="c">(* SystemF *)</span><span class="w">
  </span><span class="kr">fun</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="no">m</span><span class="w"> </span><span class="o">(</span><span class="no">X</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">X</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="no">n</span><span class="w"> </span><span class="no">X</span><span class="o">).</span><span class="w">  </span><span class="c">(* Coq *)</span><span class="w">
</span></code></pre></div></div>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/01/03/sf-lf-03-list/" data-toggle="tooltip" data-placement="top" title="「SF-LC」3 List">
                        Previous<br>
                        <span>「SF-LC」3 List</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/01/05/sf-lf-05-tactics/" data-toggle="tooltip" data-placement="top" title="「SF-LC」5 Tactics">
                        Next<br>
                        <span>「SF-LC」5 Tactics</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                



                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

 <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  <li>
    <a href="/feed.xml">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a href="https://twitter.com/liuwayong">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/wayou">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; 牛さんの部落格 2020
                    <br>
                    Powered by <a href="http://huangxuan.me">Hux Blog</a> |
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"
                        height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Simple Jekyll Search -->
<script src="/js/simple-jekyll-search.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog(selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>
  </body>
</html>
